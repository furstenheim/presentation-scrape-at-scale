<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="/">
    <link rel="stylesheet" type="text/css" href="resources/lib/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="resources/lib/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="resources/lib/reveal.js/css/theme/moon.css" id="theme">
    <link rel="stylesheet" href="resources/lib/reveal.js/lib/css/zenburn.css">

    <link rel="stylesheet" type="text/css" href="resources/css/main.css">
    <title>NodeJS Madrid</title>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h2>Scraping at Scale</h2>
            <br>
            <p>Gabriel F√ºrstenheim</p>
            <p>@Geoblink</p>
            <p><i class="fa fa-twitter icon&#45;&#45;white"> </i>&nbsp<i class="fa fa-github icon&#45;&#45;white"></i> furstenheim</p>
        </section>
    <!-- TODO slide on geoblink!-->
        <section>
            <h2>Plan</h2>
            <ul>
                <li>Scraping with Python</li>
                <li>Chrome extensions</li>
                <li>Scraping with Chrome extensions</li>
                <li>Inside a Chrome extension</li>
                <li>From extension to Server</li>
                <li>Web scraper headless</li>
                <li>Next steps</li>
            </ul>
        </section>
        <section>
            <h2>Scraping with Python üêç</h2>
            <table>
                <tr>
                    <th class="td__shown-right">Pros</th>
                    <th>Cons</th>
                </tr>
                <tr>
                    <td class="td__shown-right td__no-bottom">Very mature libraries (scrapy)</td>
                    <td class="td__no-bottom">Lot of boilerplate repeated across projects</td>
                </tr>
                <tr>
                    <td class="td__shown-right td__no-bottom">Known language to data scientists</td>
                    <td class="td__no-bottom">It cannot execute client Javascript</td>
                </tr>
                <tr>
                    <td class="td__shown-right td__no-bottom"></td>
                    <td class="td__no-bottom">Big entry barrier for non tech people</td>
                </tr>

            </table>
        </section>
        <!--TODO
            add example of script in python
        -->
        <section>
            <h2>Chrome extensions</h2>
            <div class="two-columns">

                <ul class="spread-list">
                    <li>
                        Add functionality to browser
                    </li>
                    <li>
                        Modify DOM
                    </li>
                    <li>
                        Hook to browser events
                    </li>
                </ul>
                <div>
                    <img class="half-window" src="/resources/chrome-extensions.png" alt="">
                </div>
            </div>
        </section>
        <section>
            <h2>Examples</h2>
            <div class="two-columns">
            <ul class="spread-list">
                <li>nCage <a href="https://chrome.google.com/webstore/detail/ncage/hnbmfljfohghaepamnfokgggaejlmfol?hl=en"><i class="fa fa-external-link small-fa-icon"></i></a></li>
                <li>Web Scraper <a href="https://chrome.google.com/webstore/detail/web-scraper/jnhgnonknehpejjnehehllkliplmbmhn?hl=en"><i class="fa fa-external-link small-fa-icon"></i></a></li>
                <li>Playback <a href="https://chrome.google.com/webstore/detail/playback/fjbkloodmambdedlapedigddocpmeogm"><i class="fa fa-external-link small-fa-icon"></i></a></li>
                </ul>
                <img src="/resources/nicolas-cage.jpg" alt="">
            </div>
        </section>
        <section>
            <h2>Scraping with Chrome extensions <i class="fa fa-chrome"></i></h2>
            <table>
                <tr>
                    <th class="td__shown-right">Pros</th>
                    <th>Cons</th>
                </tr>
                <tr>
                    <td class="td__shown-right td__no-bottom">Low entry barrier for non-tech people</td>
                    <td class="td__no-bottom">Extensions do not work server side</td>
                </tr>
                <tr>
                    <td class="td__shown-right td__no-bottom">It executes client Javascript</td>
                    <td class="td__no-bottom">Most hated language among data scientists</td>
                </tr>
                <tr>
                    <td class="td__shown-right td__no-bottom">Almost no boilerplate</td>
                    <td class="td__no-bottom"></td>
                </tr>

            </table>
        </section>
        <section>
            <h2>Inside a Chrome extension</h2>
            <div class="img-holder">
                <img src="/resources/browser-architecture.svg" alt="">
            </div>
        </section>
        <section>
            <h2>Highway to Headless üé∏</h2>
            <p>Devtools Page <span>&#8594;</span> Library API</p>
            <p>Background Page <span>&#8594;</span> Node.js</p>
            <p>Context Page <span>&#8594;</span> ¬ø?</p>
        </section>
        <section>
            <h2>What we need:</h2>
            <p>Fake browser</p>
            <p>No global variables</p>
            <p>Same code in the browser and in node</p>
            <img src="/resources/window-as-placeholder.png" alt="">
        </section>
        <section>
            <h2>One refactor after</h2>
                <?xml version="1.0" encoding="UTF-8" standalone="no"?>
                <!-- Created with Inkscape (http://www.inkscape.org/) -->
            <div class="img-holder">
                <svg
                        xmlns:dc="http://purl.org/dc/elements/1.1/"
                        xmlns:cc="http://creativecommons.org/ns#"
                        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                        xmlns:svg="http://www.w3.org/2000/svg"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                        xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                        height="100%"
                        viewBox="0 0 686.97121 743.1274"
                        id="svg2"
                        version="1.1"
                        inkscape:version="0.91 r13725"
                        sodipodi:docname="context-page-headless.svg">
                    <defs
                            id="defs4">
                        <marker
                                inkscape:isstock="true"
                                style="overflow:visible"
                                id="marker4986"
                                refX="0"
                                refY="0"
                                orient="auto"
                                inkscape:stockid="Arrow2Lend">
                            <path
                                    transform="matrix(-1.1,0,0,-1.1,-1.1,0)"
                                    d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
                                    style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.625;stroke-linejoin:round;stroke-opacity:1"
                                    id="path4988"
                                    inkscape:connector-curvature="0" />
                        </marker>
                        <marker
                                inkscape:stockid="Arrow2Lend"
                                orient="auto"
                                refY="0"
                                refX="0"
                                id="marker4938"
                                style="overflow:visible"
                                inkscape:isstock="true"
                                inkscape:collect="always">
                            <path
                                    id="path4940"
                                    style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.625;stroke-linejoin:round;stroke-opacity:1"
                                    d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
                                    transform="matrix(-1.1,0,0,-1.1,-1.1,0)"
                                    inkscape:connector-curvature="0" />
                        </marker>
                        <marker
                                inkscape:isstock="true"
                                style="overflow:visible"
                                id="marker4478"
                                refX="0"
                                refY="0"
                                orient="auto"
                                inkscape:stockid="Arrow2Lend"
                                inkscape:collect="always">
                            <path
                                    transform="matrix(-1.1,0,0,-1.1,-1.1,0)"
                                    d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
                                    style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.625;stroke-linejoin:round;stroke-opacity:1"
                                    id="path4480"
                                    inkscape:connector-curvature="0" />
                        </marker>
                        <marker
                                inkscape:stockid="Arrow2Lend"
                                orient="auto"
                                refY="0"
                                refX="0"
                                id="Arrow2Lend"
                                style="overflow:visible"
                                inkscape:isstock="true"
                                inkscape:collect="always">
                            <path
                                    id="path4189"
                                    style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.625;stroke-linejoin:round;stroke-opacity:1"
                                    d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z"
                                    transform="matrix(-1.1,0,0,-1.1,-1.1,0)"
                                    inkscape:connector-curvature="0" />
                        </marker>
                        <marker
                                inkscape:stockid="Arrow1Lstart"
                                orient="auto"
                                refY="0"
                                refX="0"
                                id="Arrow1Lstart"
                                style="overflow:visible"
                                inkscape:isstock="true">
                            <path
                                    id="path4168"
                                    d="M 0,0 5,-5 -12.5,0 5,5 0,0 Z"
                                    style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1pt;stroke-opacity:1"
                                    transform="matrix(0.8,0,0,0.8,10,0)"
                                    inkscape:connector-curvature="0" />
                        </marker>
                    </defs>
                    <sodipodi:namedview
                            id="base"
                            pagecolor="#ffffff"
                            bordercolor="#666666"
                            borderopacity="1.0"
                            inkscape:pageopacity="0.0"
                            inkscape:pageshadow="2"
                            inkscape:zoom="0.98994949"
                            inkscape:cx="473.65715"
                            inkscape:cy="396.45597"
                            inkscape:document-units="px"
                            inkscape:current-layer="layer1"
                            showgrid="true"
                            inkscape:window-width="1600"
                            inkscape:window-height="844"
                            inkscape:window-x="0"
                            inkscape:window-y="27"
                            inkscape:window-maximized="1"
                            fit-margin-left="5"
                            fit-margin-right="5"
                            fit-margin-top="5"
                            fit-margin-bottom="5"
                            inkscape:snap-text-baseline="true">
                        <inkscape:grid
                                type="xygrid"
                                id="grid4594"
                                originx="-40.372305"
                                originy="-281.20107" />
                    </sodipodi:namedview>
                    <metadata
                            id="metadata7">
                        <rdf:RDF>
                            <cc:Work
                                    rdf:about="">
                                <dc:format>image/svg+xml</dc:format>
                                <dc:type
                                        rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                                <dc:title />
                            </cc:Work>
                        </rdf:RDF>
                    </metadata>
                    <g
                            inkscape:label="Layer 1"
                            inkscape:groupmode="layer"
                            id="layer1"
                            transform="translate(-40.372305,-28.033739)">
                        <rect
                                style="fill:#999999;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                                id="rect4136"
                                width="650.53815"
                                height="628.31494"
                                x="58.58884"
                                y="46.250275"
                                rx="17.8211"
                                ry="29.212" />
                        <rect
                                style="fill:#cccccc;fill-rule:evenodd;stroke:#000000;stroke-width:1.05032206px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                                id="rect4138"
                                width="593.91937"
                                height="97.330475"
                                x="84.041145"
                                y="147.84038"
                                rx="53.458767"
                                ry="10.742907" />
                        <rect
                                style="fill:#cccccc;fill-rule:evenodd;stroke:#000000;stroke-width:0.89918071px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                                id="rect4144"
                                width="230.41559"
                                height="169.80644"
                                x="433.81012"
                                y="457.83704"
                                rx="53.464497"
                                ry="12.232736" />
                        <rect
                                style="fill:#cccccc;fill-rule:evenodd;stroke:#000000;stroke-width:1.00607049px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                                id="rect4146"
                                width="281.35657"
                                height="170.33046"
                                x="91.926933"
                                y="458.4552"
                                rx="76.286354"
                                ry="12.761313" />
                        <flowRoot
       xml:space="preserve"
       id="flowRoot4148"
       style="font-size:17.5px;line-height:125%;letter-spacing:0px;word-spacing:0px;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"><flowRegion
         id="flowRegion4150"><rect
           id="rect4152"
           width="397.14285"
           height="50"
           x="180"
           y="78.076492" /></flowRegion><flowPara
         id="flowPara4154" /></flowRoot>    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:28.96157837px;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="282.70258"
       y="109.42937"
       id="text4156"
       sodipodi:linespacing="125%"
       transform="scale(1.0334506,0.96763211)"><tspan
         sodipodi:role="line"
         id="tspan4158"
         x="282.70258"
         y="109.42937">Context Page</tspan><tspan
         sodipodi:role="line"
         x="282.70258"
         y="145.63135"
         id="tspan4160" /></text>
                        <path
                                style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.11111283px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#Arrow2Lend)"
                                d="M 223.32929,458.831 364.3852,246.84528"
                                id="path4162"
                                inkscape:connector-curvature="0" />
                        <path
                                style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.07390594px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#marker4478)"
                                d="M 559.88446,457.89299 425.53041,247.2647"
                                id="path4470"
                                inkscape:connector-curvature="0" />
                        <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:17.5px;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="462.65082"
       y="527.35272"
       id="text5347"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         x="462.65082"
         y="527.35272"
         id="tspan5349"><tspan
           x="462.65082"
           y="527.35272"
           id="tspan5351">const w = window</tspan><tspan
           dx="0"
           x="622.2016"
           y="527.35272"
           id="tspan5353" /></tspan><tspan
         sodipodi:role="line"
         x="462.65082"
         y="549.22772"
         id="tspan5355"><tspan
           x="462.65082"
           y="549.22772"
           id="tspan5357">const d = document</tspan><tspan
           dx="0"
           x="640.93207"
           y="549.22772"
           id="tspan5359" /></tspan><tspan
         sodipodi:role="line"
         x="462.65082"
         y="571.10272"
         id="tspan5361"><tspan
           x="462.65082"
           y="571.10272"
           id="tspan5363">const $ = window.$</tspan></tspan></text>
    <flowRoot
       xml:space="preserve"
       id="flowRoot4524"
       style="font-style:normal;font-weight:normal;font-size:17.5px;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"><flowRegion
         id="flowRegion4526"><rect
           id="rect4528"
           width="196.97975"
           height="70.710678"
           x="122.22845"
           y="446.27069" /></flowRegion><flowPara
         id="flowPara4530" /></flowRoot>    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:17.5px;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="110.10663"
       y="499.80878"
       id="text4532"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan4534"
         x="110.10663"
         y="499.80878">const {</tspan><tspan
         sodipodi:role="line"
         x="110.10663"
         y="521.68378"
         id="tspan4536">  window: w,</tspan><tspan
         sodipodi:role="line"
         x="110.10663"
         y="543.55878"
         id="tspan4538">  document: d</tspan><tspan
         sodipodi:role="line"
         x="110.10663"
         y="565.43378"
         id="tspan4540">} = await jsdom.fromURL(u)</tspan><tspan
         sodipodi:role="line"
         x="110.10663"
         y="587.30878"
         id="tspan4542">const $ = jQuery(window)</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:17.5px;line-height:100%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="352.73608"
       y="204.99734"
       id="text5365"
       sodipodi:linespacing="100%"><tspan
         sodipodi:role="line"
         x="352.73608"
         y="204.99734"
         id="tspan5367"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:25px;line-height:100%;text-align:start;writing-mode:lr-tb;text-anchor:start"><tspan
           x="352.73608"
           y="204.99734"
           id="tspan5369"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:25px;line-height:100%;text-align:start;writing-mode:lr-tb;text-anchor:start">Scraping</tspan></tspan></text>
                        <path
                                style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.01234376px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#marker4938)"
                                d="m 220,732.3622 0,-102.48398"
                                id="path4930"
                                inkscape:connector-curvature="0" />
                        <path
                                style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1.01234317px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#marker4986)"
                                d="m 560,732.3622 0,-102.48386"
                                id="path4978"
                                inkscape:connector-curvature="0" />
                        <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:20px;line-height:89%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"font-stretch:normal;font-variant:normal;text-anchor:start;text-align:start;writing-mode:lr;"
       x="140.10153"
       y="749.80444"
       id="text5371"
       sodipodi:linespacing="89%"><tspan
         sodipodi:role="line"
         x="140.10153"
         y="749.80444"
         id="tspan5373"><tspan
           x="100.10153"
           y="749.80444"
           id="tspan5375"
           style="font-weight:normal;font-style:normal;fill:#eee8d5; font-stretch:normal;font-variant:normal;font-size:27px;text-anchor:start;text-align:start;writing-mode:lr;line-height:89%;">Library entry point</tspan></tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:20px;line-height:80%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"font-stretch:normal;font-variant:normal;text-anchor:start;text-align:start;writing-mode:lr;"
       x="472.12183"
       y="750.81458"
       id="text5377"
       sodipodi:linespacing="80%"><tspan
         sodipodi:role="line"
         x="472.12183"
         y="750.81458"
         id="tspan5379"
         style="line-height:80%;text-align:start;writing-mode:lr;text-anchor:start;font-weight:normal;font-style:normal;font-stretch:normal;font-variant:normal;font-size:20px;"><tspan
           x="432.12183"
           y="750.81458"
           id="tspan5381"
           style="line-height:80%;text-align:start;writing-mode:lr;fill:#eee8d5; text-anchor:start;font-weight:normal;font-style:normal;font-stretch:normal;font-variant:normal;font-size:27px;"><tspan
   style="font-weight:normal;font-style:normal;font-stretch:normal;font-variant:normal;text-anchor:start;text-align:start;writing-mode:lr;line-height:80%;"
   id="tspan5395">Extension entry point</tspan></text>
    <flowRoot
       xml:space="preserve"
       id="flowRoot5383"
       style="fill:black;stroke:none;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;fill-opacity:1;ont-style:normal;font-weight:normal;font-size:17.5px;line-height:125%;letter-spacing:0px;word-spacing:0px"><flowRegion
         id="flowRegion5385"><rect
           id="rect5387"
           width="160"
           height="60"
           x="729.62769"
           y="644.32843" /></flowRegion><flowPara
         id="flowPara5389" /></flowRoot>    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:17.5px;line-height:125%;letter-spacing:0px;word-spacing:0px;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       x="840"
       y="702.36218"
       id="text5391"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan5393"
         x="840"
         y="702.36218" /></text>
                    </g>
                </svg>

            </div>
        </section>
        <section data-background="/resources/demo-time.gif">
        </section>
        <section>
            <h2>Bonus</h2>
            <p>JSDOM on the browser</p>
            <code data-trim data-noescape>
                <pre>
                    const work = require('webworkify')
                    const jsdomBrowserLoader = require('./JSDOMBrowserLoader')
                    const worker = work(jsdomBrowserLoader)
                    worker.postMessage({
                        topic: 'init',
                        sitemap
                    })
                    worker.addEventListener('message', function (ev) {
                        console.log('scraped', ev.data)
                    })
            </code></pre>
        </section>
        <section>
            <h2>Next steps</h2>
            <ul>
                <li>Using Chrome Headless</li>
                <li>Proper error propagation</li>
            </ul>
            <br>
            <br>
            <p> <a href="https://github.com/geoblink/web-scraper-chrome-extension">github.com/geoblink/web-scraper-chrome-extension</a>
            </p>
        </section>

        <section>
            <div class="img-holder">
                <img src="/resources/geoblink.jpg" alt="">
            </div>
            <p><i class="fa fa-twitter icon&#45;&#45;white"> </i>&nbsp<i class="fa fa-github icon&#45;&#45;white"></i> furstenheim</p>

        </section>

    </div>
</div>
<script src="bundle.js"></script>
</body>
</html>